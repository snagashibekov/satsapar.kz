!function(t){function e(a){if(n[a])return n[a].exports;var i=n[a]={exports:{},id:a,loaded:!1};return t[a].call(i.exports,i,i.exports,e),i.loaded=!0,i.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){"use strict";var a=angular.module("satsapar",["ui.bootstrap","ui.router","ngAnimate"]);n(3)(a),n(5)(a),n(4)(a),n(6)(a),n(7)(a),n(10)(a),n(9)(a),n(17)(a),n(8)(a),n(2)(a),n(15)(a),n(14)(a),n(11)(a),n(13)(a),n(12)(a),n(16)(a)},function(t,e){"use strict";function n(t,e){return t/1e3*e}function a(t,e,n){var a=(t+1)/n.lines,i=e-a*n.direction;(i<0||i>1)&&(i+=n.direction);var r=n.trail/100,o=1-i/r;if(o<0)return n.opacity;var s=1-n.opacity;return o*s+n.opacity}function i(t,e){if(void 0!==t.style[e])return e;var n="ms"+e.charAt(0).toUpperCase()+e.slice(1);return void 0!==t.style[n]?n:""}function r(t,e){for(var n in e)t.style[i(t,n)||n]=e[n];return t}function o(t,e){return"string"==typeof t?t:t[e%t.length]}function s(t,e){var n=Math.round(e.corners*e.width*500)/1e3+"px",a="none";e.shadow===!0?a="0 2px 4px #000":"string"==typeof e.shadow&&(a=e.shadow);for(var i=c(a),s=0;s<e.lines;s++){var u=~~(360/e.lines*s+e.rotate),p=r(document.createElement("div"),{position:"absolute",top:-e.width/2+"px",width:e.length+e.width+"px",height:e.width+"px",background:o(e.fadeColor,s),borderRadius:n,transformOrigin:"left",transform:"rotate("+u+"deg) translateX("+e.radius+"px)"}),f=r(document.createElement("div"),{width:"100%",height:"100%",background:o(e.color,s),borderRadius:n,boxShadow:l(i,u),opacity:e.opacity});p.appendChild(f),t.appendChild(p)}}function c(t){for(var e=/^\s*([a-zA-Z]+\s+)?(-?\d+(\.\d+)?)([a-zA-Z]*)\s+(-?\d+(\.\d+)?)([a-zA-Z]*)(.*)$/,n=[],a=0,i=t.split(",");a<i.length;a++){var r=i[a],o=r.match(e);if(null!==o){var s=+o[2],c=+o[5],l=o[4],u=o[7];0!==s||l||(l=u),0!==c||u||(u=l),l===u&&n.push({prefix:o[1]||"",x:s,y:c,xUnits:l,yUnits:u,end:o[8]})}}return n}function l(t,e){for(var n=[],a=0,i=t;a<i.length;a++){var r=i[a],o=u(r.x,r.y,e);n.push(r.prefix+o[0]+r.xUnits+" "+o[1]+r.yUnits+r.end)}return n.join(", ")}function u(t,e,n){var a=n*Math.PI/180,i=Math.sin(a),r=Math.cos(a);return[Math.round(1e3*(t*r+e*i))/1e3,Math.round(1e3*(-t*i+e*r))/1e3]}Object.defineProperty(e,"__esModule",{value:!0});var p=Object.assign||function(t){for(var e,n=1,a=arguments.length;n<a;n++){e=arguments[n];for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i])}return t},f={lines:12,length:7,width:5,radius:10,scale:1,corners:1,color:"#000",fadeColor:"transparent",opacity:.25,rotate:0,direction:1,speed:1,trail:100,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",shadow:"none",position:"absolute"},m=function(){function t(t){void 0===t&&(t={}),this.opts=p({},f,t)}return t.prototype.spin=function(t){var e=this;this.stop(),this.el=document.createElement("div"),this.el.className=this.opts.className,this.el.setAttribute("role","progressbar"),r(this.el,{position:this.opts.position,width:0,zIndex:this.opts.zIndex,left:this.opts.left,top:this.opts.top,transform:"scale("+this.opts.scale+")"}),t&&t.insertBefore(this.el,t.firstChild||null);var i,o;"undefined"!=typeof requestAnimationFrame?(i=requestAnimationFrame,o=function(){return performance.now()}):(i=function(t){return setTimeout(t,1e3/e.opts.fps)},o=function(){return Date.now()});var c,l=0,u=function t(){var r=o();if(void 0===c&&(c=r-1),l+=n(r-c,e.opts.speed),c=r,l>1&&(l-=Math.floor(l)),e.el.childNodes.length===e.opts.lines)for(var s=0;s<e.opts.lines;s++){var u=a(s,l,e.opts);e.el.childNodes[s].childNodes[0].style.opacity=u.toString()}e.animateId=e.el?i(t):void 0};return s(this.el,this.opts),u(),this},t.prototype.stop=function(){return this.el&&("undefined"!=typeof requestAnimationFrame?cancelAnimationFrame(this.animateId):clearTimeout(this.animateId),this.el.parentNode&&this.el.parentNode.removeChild(this.el),this.el=void 0),this},t}();e.Spinner=m},function(t,e){"use strict";t.exports=function(t){function e(t,e,n,a){var i=this;return i.getType=function(t){var e;return a.wagonTypes.forEach(function(n){n.typeValue==t&&(e=n.name)}),e},i.close=function(){t.go("home")},e.id?void n.getBookingOrder(e.id).then(function(t){i.Order=t.data},function(t){t.data?alert("Ошибка :"):t&&alert("Ошибка :")}).finally(function(){i.Order||(alert("Бронирования не существует!"),t.go("home"))}):void alert("Код бронирования пустой!")}t.controller("bookingCtrl",e),e.$inject=["$state","$stateParams","dataService","constantApi"]}},function(t,e){"use strict";t.exports=function(t){function e(t,e){t.state("home",{url:"/",templateUrl:"./Scripts/app/home/home.html",controller:"strainCtrl",controllerAs:"vm"}).state("train",{url:"/train",templateUrl:"./Scripts/app/trains/trains.html",controller:"trainsCtrl",params:{trainsInfo:null},controllerAs:"vm",resolve:{train:["dataService",function(t){return null}]}}).state("booking",{url:"/booking/:id",templateUrl:"./Scripts/app/booking/booking.html",controller:"bookingCtrl",controllerAs:"vm"}),e.otherwise("/")}moment.locale("ru"),moment.tz.setDefault("Asia/Almaty"),t.config(["$stateProvider","$urlRouterProvider",e])}},function(t,e){"use strict";t.exports=function(t){function e(t){function e(e,n,a){n.bind("keyup ",function(e){n.val(t.latinToCyrillic(n.val()||""))})}return{restrict:"A",link:e}}t.directive("latinToCyrillic",e),e.$inject=["constantApi"]}},function(t,e,n){"use strict";t.exports=function(t){function e(t){function e(t,e,n){t.spinner=null,t.$watch(n.spinner,function(n){t.spinner&&t.spinner.stop(),t.spinner=new a(n),t.spinner.spin(e[0])},!0)}var n={link:e,restrict:"A"};return n}var a=n(1).Spinner;t.directive("spinner",e),e.$inject=["$window"]}},function(t,e){"use strict";t.exports=function(t){t.directive("wagonInfo",["wagonSchema","$compile",function(t,e){function n(n,a,i){function r(t){for(var e=1e3,n=0,a="",i=0;i<t.length;i++)e>parseInt(t[i])&&(e=parseInt(t[i])),n<parseInt(t[i])&&(n=parseInt(t[i]));return a=t.length>0?t.length<=1?e:e+"-"+n:"_"}n.train.changeSchema=function(i){n.car=i,t.get(i).then(function(t){t&&n.$evalAsync(function(){a.html(t),e(a.contents())(n),n.train.selectionInText="_",n.train.selectedPlaces=[];try{a[0].focus(),a[0].scrollIntoView&&a[0].getBoundingClientRect();var i=a[0].getBoundingClientRect(),r=i.top+window.pageYOffset,o=r-window.innerHeight/2;window.scrollTo(0,o)}catch(t){console.log(t)}})})},n.schema&&n.train.changeSchema(n.schema),n.addPlace=function(t,e){if(!n.checkAvailability(e))return!0;n.train.selectedPlaces||(n.train.selectedPlaces=[]);var a=n.train.selectedPlaces,i=a.length,o=a.indexOf(e);return o>-1?(a.splice(o,1),n.train.selectionInText=r(a),t.currentTarget.classList.toggle("active"),!0):4===i?(alert("Нельзя более 4 мест выбрать"),!0):(t.currentTarget.classList.toggle("active"),a.push(e),n.train.selectionInText=r(a),!0)},n.checkAvailability=function(t){var e=n.car.Places;return e.indexOf(("000"+t).slice(-3))>-1}}return{restrict:"E",link:n,scope:{train:"="}}}])}},function(t,e){"use strict";t.exports=function(t){function e(){return function(t){return moment(t).toDate()}}function n(){return function(t,e){return moment(t).format(e)}}t.filter("getDate",e),t.filter("momentFormat",n)}},function(t,e){"use strict";t.exports=function(t){function e(t,e,n){var a=this;a.bookingCode="",a.close=function(){t.setActiveView([t.visibleData.homeMain.name],[t.visibleData.homeBooking.name,t.visibleData.rulePurchase.name,t.visibleData.ruleRefund.name])},a.getBooking=function(){return a.bookingCode?void n.go("booking",{id:a.bookingCode}):void alert("Введите код бронирования")}}t.controller("bookingInfoCtrl",e),e.$inject=["constantApi","dataService","$state"]}},function(t,e){"use strict";t.exports=function(t){function e(){return{scope:{hoverAElement:"@",className:"@"},link:function(t,e,n){e.on("mouseenter",function(){t.upperElement=angular.element(document.getElementById(t.hoverAElement)),t.upperElement.addClass(t.className)}),e.on("mouseleave",function(){t.upperElement&&t.upperElement.removeClass(t.className)})}}}function n(t,e,n,a){function i(t){t.preventDefault(),t.stopPropagation(),l.opened=!0}function r(){if(l.departureDate&&!(l.departureDate.length<1)&&!(l.departureDate<=l.minDate)){var t=moment(l.departureDate).add(-1*c,"days").toDate();l.departureDate=t.getTime()}}function o(){if(l.departureDate&&!(l.departureDate.length<1)&&!(l.departureDate>=l.maxDate)){var t=moment(l.departureDate).add(c,"days").toDate();l.departureDate=t.getTime()}}var s=50,c=1,l=this;l.visible=t.visibleData,l.open=i,l.departureDate=(new Date).getTime(),l.minDate=new Date,l.maxDate=moment(l.minDate).add(s,"days").toDate(),l.dateOptions={showWeeks:!1,useCurrent:!1,minDate:l.minDate,maxDate:l.maxDate},l.getStations=function(t){return e.getLocations(t).then(function(t){return t})},l.dateFormat={uiformat:"dd MMM EEE",momentFormat:"DD MMM ddd"},l.movPrevDate=r,l.movNextDate=o,l.openBooking=function(e){t.setActiveView([e],[t.visibleData.homeMain.name]),n.scrollTo(0,0)},l.switchDirections=function(){var t=l.fromStation;l.fromStation=l.toStation,l.toStation=t},l.getTrains=function(){var t="";l.fromStation&&0!==l.fromStation.length&&l.fromStation.locationValue||(t+="Выберите город отправление из списка! \n"),l.toStation&&0!==l.toStation.length&&l.toStation.locationValue||(t+="Выберите город назначение из списка! \n"),(!l.departureDate||l.departureDate<l.minDate)&&(t+="Дата отправление не корректно!!"),0===t.length?e.getTrains(moment(l.departureDate).format("DD.MM.YYYY"),l.fromStation.locationValue,l.toStation.locationValue).then(function(t){var e=t.data;if(void 0===e)return void alert("В указанную дату поезд не ходит либо произошла ошибка при поиске на эту дату! ");try{if(!("Trains"in e))return void alert(e)}catch(t){return void alert(e)}a.go("train",{trainsInfo:e})}):alert(t)}}t.controller("strainCtrl",n).directive("hoverAElement",e),n.$inject=["constantApi","dataService","$window","$state"]}},function(t,e){"use strict";t.exports=function(t){function e(t){var e=this;e.showSpinner=!1,e.spinnerMessage="Загрузка ...",e.spinnerOptions={radius:40,lines:8,length:0,width:30,speed:1.7,corners:1,trail:100,color:"#2577e3"},t.$on("spinner.toggle",function(t,n){e.showSpinner=n.show,n.message&&(e.spinnerMessage=n.message)})}t.controller("shellCtrl",e),e.$inject=["$rootScope"]}},function(t,e){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t};t.exports=function(t){function e(t){var e=t.localStorage;return{exists:function(t){return void 0!==e[t]},delete:function(t){this.exists(t)&&e.removeItem(t)},get:function(t){var n,a=null;if(this.exists(t)){n=e[t];try{a=JSON.parse(n)}catch(t){"SyntaxError"===t.constructor.name&&(a=n)}}return a},save:function(t,a){if("object"===("undefined"==typeof a?"undefined":n(a))){var i=[];e.setItem(t,JSON.stringify(a,function(t,e){if(null!=e&&"object"==("undefined"==typeof e?"undefined":n(e))){if(i.indexOf(e)>=0)return;i.push(e)}return e}))}else e.setItem(t,a)}}}t.factory("clientStorage",e),e.$inject=["$window"]}},function(t,e){"use strict";t.exports=function(t){function e(){function t(t){for(var e="",a=0;a<t.length;a++){var i=t[a];n.some(function(t){return t.latin===i.toLowerCase()&&(i=t.cyrillic,!0)}),e+=i}return e}function e(t,e){_.isArray(t)&&t.forEach(function(t){a[t].value=!0}),_.isArray(e)&&e.forEach(function(t){a[t].value=!1})}var n=[{latin:"a",cyrillic:"а"},{latin:"s",cyrillic:"с"},{latin:"d",cyrillic:"д"},{latin:"f",cyrillic:"ф"},{latin:"g",cyrillic:"г"},{latin:"h",cyrillic:"х"},{latin:"j",cyrillic:"ж"},{latin:"k",cyrillic:"к"},{latin:"l",cyrillic:"л"},{latin:"z",cyrillic:"з"},{latin:"x",cyrillic:"х"},{latin:"c",cyrillic:"с"},{latin:"v",cyrillic:"в"},{latin:"b",cyrillic:"б"},{latin:"n",cyrillic:"н"},{latin:"m",cyrillic:"м"},{latin:"q",cyrillic:"к"},{latin:"w",cyrillic:"в"},{latin:"e",cyrillic:"е"},{latin:"r",cyrillic:"р"},{latin:"t",cyrillic:"т"},{latin:"y",cyrillic:"ю"},{latin:"u",cyrillic:"у"},{latin:"i",cyrillic:"и"},{latin:"o",cyrillic:"о"},{latin:"p",cyrillic:"п"}],a={homeMain:{name:"homeMain",value:!0},homeBooking:{name:"homeBooking",value:!1},rulePurchase:{name:"rulePurchase",value:!1},ruleRefund:{name:"ruleRefund",value:!1}},i=[{name:"Общий",shortName:"Общи",typeValue:1},{name:"Сидячий",shortName:"Сидяч",typeValue:2},{name:"Плацкартный",shortName:"Плацк",typeValue:3},{name:"Купе",shortName:"Купе",typeValue:4},{name:"Мягкий",shortName:"Мягк",typeValue:5},{name:"Люкс",shortName:"Люкс",typeValue:6}],r=[{type:"Купе",typeValue:4,special:0,value:0,classService:"",maxplaces:36,schema:"Scripts/app/trains/wagon/schema0.html"},{type:"Купе",typeValue:4,special:0,value:11,maxplaces:40,schema:"Scripts/app/trains/wagon/schema11.html"},{type:"Купе",typeValue:4,special:1,value:1,maxplaces:12,schema:"Scripts/app/trains/wagon/schema1.html"},{type:"Купе",typeValue:4,special:2,value:7,maxplaces:100,schema:"Scripts/app/trains/wagon/schema7.html"},{type:"Плацкартный",typeValue:3,special:0,value:3,maxplaces:54,schema:"Scripts/app/trains/wagon/schema3.html"},{type:"Плацкартный",typeValue:3,special:1,value:4,maxplaces:18,schema:"Scripts/app/trains/wagon/schema4.html"},{type:"Плацкартный",typeValue:3,special:2,value:5,maxplaces:60,schema:"Scripts/app/trains/wagon/schema5.html"},{type:"Люкс",typeValue:6,special:0,value:6,maxplaces:18,schema:"Scripts/app/trains/wagon/schema6.html"},{type:"Люкс",typeValue:6,special:1,value:8,maxplaces:10,schema:"Scripts/app/trains/wagon/schema8.html"},{type:"Люкс",typeValue:6,special:2,value:7,maxplaces:100,schema:"Scripts/app/trains/wagon/schema7.html"},{type:"Общий",typeValue:1,special:0,value:10,maxplaces:81,schema:"Scripts/app/trains/wagon/schema10.html"},{type:"Плацкартный",typeValue:3,special:0,value:12,maxplaces:56,schema:"Scripts/app/trains/wagon/schema12.html"},{type:"Другие",special:-1,value:7,schema:"Scripts/app/trains/wagon/schema7.html"}];if(document.getElementById("__RequestVerificationToken"))var o=document.getElementById("__RequestVerificationToken").value;return{Token:o?o:"",visibleData:a,setActiveView:e,latinToCyrillic:t,wagonTypes:i,schemaTypes:r}}t.factory("constantApi",e)}},function(t,e){"use strict";t.exports=function(t){function e(){return{request:function(t){return"/Home/SearchTrains"!==t.url&&"/Home/StationAutoComplete"!==t.url&&"/Home/GetTrain"!==t.url&&"/Booking/BookingInfo"!==t.url||(t.url="http://localhost:3000"+t.url,t.method="GET"),t},requestError:function(t){return t},response:function(t){return t}}}t.factory("httpIntercept",e),t.config(["$httpProvider",function(t){t.interceptors.push("httpIntercept")}])}},function(t,e){"use strict";t.exports=function(t){function e(t,e,n){function a(t){function e(t){return _.flatMap(t.data?t.data:t,function(t){return{locationValue:t.StationCode,label:t.StationName}})}return s("/Home/StationAutoComplete",{term:n.latinToCyrillic(t)},"GET",!0).then(e)}function i(t){return s("/Booking/BookingInfo",{bookingCode:t},"GET")}function r(t,e,n){return s("/Home/SearchTrains",{when:t,stationFromCode:e,stationToCode:n},"POST")}function o(t,e,n,a){return s("/Home/GetTrain",{fromStationCode:t,toStationCode:e,departureDateTime:n,trainNumber:a},"GET")}function s(n,a,i,r){return r||e.showSpinner(),i&&"GET"===i.toUpperCase()?t({headers:c,url:n,params:a,method:i}).finally(function(){r||e.hideSpinner()}):t({headers:c,url:n,data:a,method:i}).finally(function(){e.hideSpinner()})}var c={__RequestVerificationToken:n.Token};return{getLocations:a,getTrains:r,getTrain:o,getBookingOrder:i}}t.factory("dataService",e),e.$inject=["$http","satSpinner","constantApi"]}},function(t,e){"use strict";t.exports=function(t){function e(t){function e(){a(!1)}function n(t){a(!0,t)}function a(e,n){t.$broadcast("spinner.toggle",{show:e,message:n})}var i={hideSpinner:e,showSpinner:n};return i}t.factory("satSpinner",["$rootScope",e])}},function(t,e){"use strict";t.exports=function(t){function e(t,e,n){function a(t){null!==t.SpecialCarDetails&&"undefined"!==t.SpecialCarDetails&&0!==t.SpecialCarDetails.length||(t.SpecialCarDetails=[0]);for(var e=null,n=0;n<r.length;n++)if(r[n].type.toLowerCase()===t.Type.toLowerCase()&&(t.SpecialCarDetails[0]===r[n].special||t.ClassService.Type===r[n].classService)){if(t.ClassService.Type===r[n].classService)return r[n].schema;for(var a=!1,i=0;i<t.Places.length;i++)parseInt(t.Places[i])>r[n].maxplaces&&(a=!0);a||(e=r[n].schema)}return e||r[r.length-1].schema}function i(n){var i=a(n);if(!i)return new Promise(function(t){setTimeout(function(){t(null)},0)});var r=e.get(i);return r?new Promise(function(t){setTimeout(function(){t(r)},0)}):t.get(i).then(function(t){return e.put(i,t.data),e.get(i)})}var r=n.schemaTypes;return{get:i}}t.factory("wagonSchema",e),e.$inject=["$http","$templateCache","constantApi"]}},function(t,e){"use strict";t.exports=function(t){function e(t,e,n,a,i,r){var o=this;o.trainsInfo=e.trainsInfo,o.dates=[moment(o.trainsInfo.Trains[0].Date).subtract(1,"day").toDate(),moment(o.trainsInfo.Trains[0].Date).toDate(),moment(o.trainsInfo.Trains[0].Date).add(1,"day").toDate()];var s=i.wagonTypes;o.getCapitalized=function(t){return t?t.charAt(0).toUpperCase()+t.slice(1).toLowerCase():t},o.getCar=function(t,e,a,i){o.activeTrain&&o.activeTrain.schema&&(o.activeTrain.schema=void 0,o.activeTrain.SelectedCars=void 0),o.activeTrain=t,t.SelectedCars=null,n.getTrain(o.trainsInfo.PassRouteCodeFrom,o.trainsInfo.PassRouteCodeTo,moment(t.DepartureDateTime).format("DD-MM-YY HH:mm:ss"),t.Number).then(function(n){for(var s,c=n.data||n,l=c.ForwardDirectionDto.Trains[0].Train.Cars,u=!1,p=0;p<l.length;p++){o.getWagonType(l[p].Type,l[p].ClassService).toLowerCase()===e.toLowerCase()||l[p].Type.toLowerCase()===e.toLowerCase()?(!u||l[p].ClassService.Type!==a.Type&&l[p].Tariff!==i?u||(s=l[p]):s=l[p],u=!0):u||"плацкартный"!==l[p].Type.toLowerCase()&&"купе"!==l[p].Type.toLowerCase()&&"люкс"!==l[p].Type.toLowerCase()&&l[p].Tariff===i&&l[p].ClassService.Type===a.Type&&(t=!0,s=l[p]);var f=0;l[p].Cars.forEach(function(t){f+=t.Places.length})}s?s.Cars[0].selected=!0:alert(e+" не найден!"),t.detailedCars=l,t.SelectedCars=s,r(function(){o.changeCar(t,s.Cars[0],s)})},function(t){alert(t.data||t)})},o.getWagonType=function(t,e){var n="";return e&&e.Value&&s.forEach(function(t){e.Value.toLowerCase().indexOf(t.shortName.toLowerCase())!==-1&&(n=t.shortName)}),n||s.forEach(function(e){e.typeValue==t&&(n=e.shortName)}),n},o.moveDate=function(t){o.dates[t]>=(new Date).setHours(0,0,0,0)&&(o.dates=[moment(o.dates[t]).subtract(1,"day").toDate(),moment(o.dates[t]).toDate(),moment(o.dates[t]).add(1,"day").toDate()]),n.getTrains(moment(o.dates[1]).format("DD.MM.YYYY"),o.trainsInfo.PassRouteCodeFrom,o.trainsInfo.PassRouteCodeTo).then(function(t){var e=t.data;if(void 0===e)return void alert("В указанную дату поезд не ходит либо произошла ошибка при поиске на эту дату! ");try{if(!("Trains"in e))return void alert(e)}catch(t){return void alert(e)}o.trainsInfo=e})},o.changeCar=function(t,e,n){n.Cars.forEach(function(t){t.selected=!1}),e.selected=!0,e.Type=n.Type,e.ClassService=n.ClassService,t.changeSchema(e)}}t.controller("trainsCtrl",["$state","$stateParams","dataService","train","constantApi","$timeout",e])}}]);